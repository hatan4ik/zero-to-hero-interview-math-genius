name: ci

on:
  push:
  pull_request:

jobs:
  python:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install -r requirements-dev.txt
      - name: Run Python tests
        run: |
          pytest -q

  java_cpp:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Compile Java sources
        run: |
          find part1-coding -name "*.java" > sources.txt
          mkdir -p out
          if [ -s sources.txt ]; then javac -d out @sources.txt part1-coding/java-tests/RunTests.java; fi
      - name: Run Java tests
        run: |
          if [ -d out ]; then cd out && java RunTests; fi
      - name: Build & run C++ samples
        run: |
          set -e
          for f in part1-coding/*/cpp/*.cpp; do
            g++ -std=c++20 -O2 -Wall -Werror "$f" -o /tmp/$(basename "$f" .cpp).out
          done
          # Small sanity test runners
          g++ -std=c++20 -O2 -Wall -Werror part1-coding/cpp-tests/test_two_sum.cpp part1-coding/01-hash-two-sum/cpp/01-hash-two-sum.cpp -o /tmp/test_two_sum.out
          /tmp/test_two_sum.out
          g++ -std=c++20 -O2 -Wall -Werror part1-coding/cpp-tests/test_merge.cpp part1-coding/04-intervals-merge/cpp/04-intervals-merge.cpp -o /tmp/test_merge.out
          /tmp/test_merge.out
          g++ -std=c++20 -O2 -Wall -Werror part1-coding/cpp-tests/test_heap.cpp part1-coding/07-heap-meeting-rooms/cpp/07-heap-meeting-rooms.cpp -o /tmp/test_heap.out
          /tmp/test_heap.out
